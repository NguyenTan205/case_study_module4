<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Danh s√°ch ng∆∞·ªùi d√πng</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
  <h2 class="text-center mb-4">üë• Danh s√°ch ng∆∞·ªùi d√πng</h2>

  <div th:if="${param.success}">
    <div class="alert alert-success text-center">
      ‚úÖ C·∫≠p nh·∫≠t quy·ªÅn th√†nh c√¥ng!
    </div>
  </div>

  <table class="table table-bordered table-hover shadow-sm">
    <thead class="table-primary">
    <tr>
      <th>ID</th>
      <th>T√™n ƒëƒÉng nh·∫≠p</th>
      <th>Quy·ªÅn hi·ªán t·∫°i</th>
      <th>Thao t√°c</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="user : ${users}">
      <td th:text="${user.id}"></td>
      <td th:text="${user.username}"></td>

      <!-- C·ªôt hi·ªÉn th·ªã quy·ªÅn -->
      <td>
        <span th:text="${#strings.listJoin(userRoles[user.id], ', ')}"></span>
      </td>

      <!-- N·∫øu user KH√îNG ph·∫£i admin th√¨ hi·ªÉn th·ªã form ph√¢n quy·ªÅn -->
      <td th:if="${!#lists.contains(userRoles[user.id], 'ROLE_ADMIN')}">
        <form th:action="@{'/admin/updateRole/' + ${user.id}}" method="post" class="d-flex align-items-center">
          <select name="role" class="form-select me-2">
            <option value="ROLE_STUDENT"
                    th:selected="${#lists.contains(userRoles[user.id], 'ROLE_STUDENT')}">
              H·ªçc vi√™n
            </option>
            <option value="ROLE_TEACHER"
                    th:selected="${#lists.contains(userRoles[user.id], 'ROLE_TEACHER')}">
              Gi√°o vi√™n
            </option>
            <option value="ROLE_ADMIN"
                    th:selected="${#lists.contains(userRoles[user.id], 'ROLE_ADMIN')}">
              Qu·∫£n tr·ªã vi√™n
            </option>
          </select>
          <button type="submit" class="btn btn-success btn-sm">C·∫≠p nh·∫≠t</button>
        </form>
      </td>

      <!-- N·∫øu l√† admin th√¨ ch·ªâ hi·ªÉn th·ªã th√¥ng b√°o -->
      <td th:if="${#lists.contains(userRoles[user.id], 'ROLE_ADMIN')}">
        <span class="badge bg-secondary">ADMIN</span>
      </td>
    </tr>
    </tbody>
  </table>
  <div class="text-center mt-4">
    <a th:href="@{/admin/home}" class="btn btn-outline-primary">
      ‚¨ÖÔ∏è Quay l·∫°i trang ch·ªß
    </a>
  </div>
</div>

</body>
</html>
